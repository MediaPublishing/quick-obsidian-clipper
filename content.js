(()=>{"use strict";function e(e){return new Promise(t=>setTimeout(t,e))}function t(e){try{const t=e.querySelector('[data-testid="User-Name"]'),n=t?.querySelector("span")?.textContent||"Unknown",r=t?.querySelector("a")?.textContent||"@unknown",o=e.querySelector('[data-testid="tweetText"]'),i=o?.textContent||"",a=e.querySelector("time"),l=a?.getAttribute("datetime")||(new Date).toISOString(),c=e.querySelector('[data-testid="like"]'),s=e.querySelector('[data-testid="retweet"]'),u=e.querySelector('[data-testid="reply"]'),m=parseInt(c?.textContent?.replace(/[^0-9]/g,"")||"0",10),d=parseInt(s?.textContent?.replace(/[^0-9]/g,"")||"0",10),p=parseInt(u?.textContent?.replace(/[^0-9]/g,"")||"0",10),f=e.querySelector('a[href*="/status/"]'),h=f?`https://twitter.com${f.getAttribute("href")}`:window.location.href,g=e.querySelectorAll('img[src*="pbs.twimg.com"]'),y=Array.from(g).map(e=>e.getAttribute("src")||"").filter(Boolean),T=h.match(/status\/(\d+)/);return{id:T?T[1]:"",author:n,authorHandle:r,content:i,timestamp:l,likes:m,retweets:d,replies:p,url:h,mediaUrls:y}}catch(e){return console.error("Failed to extract tweet element:",e),null}}function n(e){const{mainTweet:t,replies:n}=e,r=(new Date).toISOString().split("T")[0],o=["---",`title: "Tweet by ${t.author}"`,"source: twitter",`url: "${t.url}"`,`author: "${t.author}"`,`author_handle: "${t.authorHandle}"`,`date_saved: ${r}`,`date_published: ${t.timestamp.split("T")[0]}`,"type: tweet","tags:","  - clipping/twitter","  - social-media","related:",`  - "[[${t.author}]]"`,"---","",`# Tweet by ${t.author}`,"",`**Author:** [[${t.author}]] (${t.authorHandle})`,`**Published:** ${new Date(t.timestamp).toLocaleString()}`,`**URL:** ${t.url}`,"","## Tweet Content","",`> ${t.content.split("\n").join("\n> ")}`,"","**Engagement:**",`- üí¨ ${t.replies.toLocaleString()} replies`,`- üîÅ ${t.retweets.toLocaleString()} retweets`,`- ‚ù§Ô∏è ${t.likes.toLocaleString()} likes`,""];return t.mediaUrls.length>0&&(o.push("## Media",""),t.mediaUrls.forEach((e,t)=>{o.push(`![Image ${t+1}](${e})`,"")})),n.length>0&&(o.push("## Top Replies",""),n.forEach((e,t)=>{o.push(`### ${t+1}. ${e.author} (${e.authorHandle})`,"",`> ${e.content.split("\n").join("\n> ")}`,"",`**Engagement:** ${e.likes} likes, ${e.retweets} retweets`,"","---","")})),o.push("## Notes","","\x3c!-- Add your thoughts here --\x3e",""),o.join("\n")}function r(e,t){return Array(t+1).join(e)}function o(e){return e.replace(/^\n*/,"")}function i(e){for(var t=e.length;t>0&&"\n"===e[t-1];)t--;return e.substring(0,t)}function a(e){return i(o(e))}var l=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function c(e){return d(e,l)}var s=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function u(e){return d(e,s)}var m=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function d(e,t){return t.indexOf(e.nodeName)>=0}function p(e,t){return e.getElementsByTagName&&t.some(function(t){return e.getElementsByTagName(t).length})}var f={};function h(e){return e?e.replace(/(\n+\s*)+/g,"\n"):""}function g(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}function y(e,t,n){for(var r=0;r<e.length;r++){var o=e[r];if(T(o,t,n))return o}}function T(e,t,n){var r=e.filter;if("string"==typeof r){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof r)throw new TypeError("`filter` needs to be a string, array, or function");if(r.call(e,t,n))return!0}}function S(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function A(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}f.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},f.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+"\n"}},f.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,n){var o=Number(t.nodeName.charAt(1));return"setext"===n.headingStyle&&o<3?"\n\n"+e+"\n"+r(1===o?"=":"-",e.length)+"\n\n":"\n\n"+r("#",o)+" "+e+"\n\n"}},f.blockquote={filter:"blockquote",replacement:function(e){return"\n\n"+(e=a(e).replace(/^/gm,"> "))+"\n\n"}},f.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},f.listItem={filter:"li",replacement:function(e,t,n){var r=n.bulletListMarker+"   ",o=t.parentNode;if("OL"===o.nodeName){var i=o.getAttribute("start"),l=Array.prototype.indexOf.call(o.children,t);r=(i?Number(i)+l:l+1)+".  "}var c=/\n$/.test(e);return r+(e=(e=a(e)+(c?"\n":"")).replace(/\n/gm,"\n"+" ".repeat(r.length)))+(t.nextSibling?"\n":"")}},f.indentedCodeBlock={filter:function(e,t){return"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},f.fencedCodeBlock={filter:function(e,t){return"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){for(var o,i=((t.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],a=t.firstChild.textContent,l=n.fence.charAt(0),c=3,s=new RegExp("^"+l+"{3,}","gm");o=s.exec(a);)o[0].length>=c&&(c=o[0].length+1);var u=r(l,c);return"\n\n"+u+i+"\n"+a.replace(/\n$/,"")+"\n"+u+"\n\n"}},f.horizontalRule={filter:"hr",replacement:function(e,t,n){return"\n\n"+n.hr+"\n\n"}},f.inlineLink={filter:function(e,t){return"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var r=h(t.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+r+")"}},f.referenceLink={filter:function(e,t){return"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t,n){var r,o,i=t.getAttribute("href"),a=h(t.getAttribute("title"));switch(a&&(a=' "'+a+'"'),n.linkReferenceStyle){case"collapsed":r="["+e+"][]",o="["+e+"]: "+i+a;break;case"shortcut":r="["+e+"]",o="["+e+"]: "+i+a;break;default:var l=this.references.length+1;r="["+e+"]["+l+"]",o="["+l+"]: "+i+a}return this.references.push(o),r},references:[],append:function(e){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},f.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}},f.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}},f.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!n},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",r=e.match(/`+/gm)||[];-1!==r.indexOf(n);)n+="`";return n+t+e+t+n}},f.image={filter:"img",replacement:function(e,t){var n=h(t.getAttribute("alt")),r=t.getAttribute("src")||"",o=h(t.getAttribute("title"));return r?"!["+n+"]("+r+(o?' "'+o+'"':"")+")":""}},g.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){return e.isBlank?this.blankRule:(t=y(this.array,e,this.options))||(t=y(this._keep,e,this.options))||(t=y(this._remove,e,this.options))?t:this.defaultRule;var t},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};var b,E,w="undefined"!=typeof window?window:{},N=function(){var e=w.DOMParser,t=!1;try{(new e).parseFromString("","text/html")&&(t=!0)}catch(e){}return t}()?w.DOMParser:(b=function(){},function(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){w.ActiveXObject&&(e=!0)}return e}()?b.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:b.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t},b);function v(e,t){var n;return function(e){var t=e.element,n=e.isBlock,r=e.isVoid,o=e.isPre||function(e){return"PRE"===e.nodeName};if(t.firstChild&&!o(t)){for(var i=null,a=!1,l=null,c=A(l,t,o);c!==t;){if(3===c.nodeType||4===c.nodeType){var s=c.data.replace(/[ \r\n\t]+/g," ");if(i&&!/ $/.test(i.data)||a||" "!==s[0]||(s=s.substr(1)),!s){c=S(c);continue}c.data=s,i=c}else{if(1!==c.nodeType){c=S(c);continue}n(c)||"BR"===c.nodeName?(i&&(i.data=i.data.replace(/ $/,"")),i=null,a=!1):r(c)||o(c)?(i=null,a=!0):i&&(a=!1)}var u=A(l,c,o);l=c,c=u}i&&(i.data=i.data.replace(/ $/,""),i.data||S(i))}}({element:n="string"==typeof e?(E=E||new N).parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):e.cloneNode(!0),isBlock:c,isVoid:u,isPre:t.preformattedCode?C:null}),n}function C(e){return"PRE"===e.nodeName||"CODE"===e.nodeName}function x(e,t){return e.isBlock=c(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=function(e){return!u(e)&&!function(e){return d(e,m)}(e)&&/^\s*$/i.test(e.textContent)&&!function(e){return p(e,s)}(e)&&!function(e){return p(e,m)}(e)}(e),e.flankingWhitespace=function(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n,r={leading:(n=e.textContent.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/))[1],leadingAscii:n[2],leadingNonAscii:n[3],trailing:n[4],trailingNonAscii:n[5],trailingAscii:n[6]};return r.leadingAscii&&_("left",e,t)&&(r.leading=r.leadingNonAscii),r.trailingAscii&&_("right",e,t)&&(r.trailing=r.trailingNonAscii),{leading:r.leading,trailing:r.trailing}}(e,t),e}function _(e,t,n){var r,o,i;return"left"===e?(r=t.previousSibling,o=/ $/):(r=t.nextSibling,o=/^ /),r&&(3===r.nodeType?i=o.test(r.nodeValue):n.preformattedCode&&"CODE"===r.nodeName?i=!1:1!==r.nodeType||c(r)||(i=o.test(r.textContent))),i}var D=Array.prototype.reduce,R=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function O(e){if(!(this instanceof O))return new O(e);var t={rules:f,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,t){return t.isBlock?"\n\n":""},keepReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML},defaultReplacement:function(e,t){return t.isBlock?"\n\n"+e+"\n\n":e}};this.options=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}({},t,e),this.rules=new g(this.options)}function k(e){var t=this;return D.call(e.childNodes,function(e,n){var r="";return 3===(n=new x(n,t.options)).nodeType?r=n.isCode?n.nodeValue:t.escape(n.nodeValue):1===n.nodeType&&(r=I.call(t,n)),M(e,r)},"")}function L(e){var t=this;return this.rules.forEach(function(n){"function"==typeof n.append&&(e=M(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function I(e){var t=this.rules.forNode(e),n=k.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function M(e,t){var n=i(e),r=o(t),a=Math.max(e.length-n.length,t.length-r.length);return n+"\n\n".substring(0,a)+r}O.prototype={turndown:function(e){if(!function(e){return null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType))}(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=k.call(this,new v(e,this.options));return L.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return R.reduce(function(e,t){return e.replace(t[0],t[1])},e)}};const P=O,{entries:U,setPrototypeOf:H,isFrozen:F,getPrototypeOf:B,getOwnPropertyDescriptor:z}=Object;let{freeze:$,seal:q,create:G}=Object,{apply:W,construct:Y}="undefined"!=typeof Reflect&&Reflect;$||($=function(e){return e}),q||(q=function(e){return e}),W||(W=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.apply(t,r)}),Y||(Y=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new e(...n)});const j=ce(Array.prototype.forEach),V=ce(Array.prototype.lastIndexOf),X=ce(Array.prototype.pop),K=ce(Array.prototype.push),Z=ce(Array.prototype.splice),Q=ce(String.prototype.toLowerCase),J=ce(String.prototype.toString),ee=ce(String.prototype.match),te=ce(String.prototype.replace),ne=ce(String.prototype.indexOf),re=ce(String.prototype.trim),oe=ce(Object.prototype.hasOwnProperty),ie=ce(RegExp.prototype.test),ae=(le=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Y(le,t)});var le;function ce(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return W(e,t,r)}}function se(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q;H&&H(e,null);let r=t.length;for(;r--;){let o=t[r];if("string"==typeof o){const e=n(o);e!==o&&(F(t)||(t[r]=e),o=e)}e[o]=!0}return e}function ue(e){for(let t=0;t<e.length;t++)oe(e,t)||(e[t]=null);return e}function me(e){const t=G(null);for(const[n,r]of U(e))oe(e,n)&&(Array.isArray(r)?t[n]=ue(r):r&&"object"==typeof r&&r.constructor===Object?t[n]=me(r):t[n]=r);return t}function de(e,t){for(;null!==e;){const n=z(e,t);if(n){if(n.get)return ce(n.get);if("function"==typeof n.value)return ce(n.value)}e=B(e)}return function(){return null}}const pe=$(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),fe=$(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),he=$(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ge=$(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ye=$(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Te=$(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Se=$(["#text"]),Ae=$(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),be=$(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ee=$(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),we=$(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ne=q(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ve=q(/<%[\w\W]*|[\w\W]*%>/gm),Ce=q(/\$\{[\w\W]*/gm),xe=q(/^data-[\-\w.\u00B7-\uFFFF]+$/),_e=q(/^aria-[\-\w]+$/),De=q(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Re=q(/^(?:\w+script|data):/i),Oe=q(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ke=q(/^html$/i),Le=q(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ie=Object.freeze({__proto__:null,ARIA_ATTR:_e,ATTR_WHITESPACE:Oe,CUSTOM_ELEMENT:Le,DATA_ATTR:xe,DOCTYPE_NAME:ke,ERB_EXPR:ve,IS_ALLOWED_URI:De,IS_SCRIPT_OR_DATA:Re,MUSTACHE_EXPR:Ne,TMPLIT_EXPR:Ce});const Me=function(){return"undefined"==typeof window?null:window};var Pe=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me();const n=t=>e(t);if(n.version="3.3.1",n.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return n.isSupported=!1,n;let{document:r}=t;const o=r,i=o.currentScript,{DocumentFragment:a,HTMLTemplateElement:l,Node:c,Element:s,NodeFilter:u,NamedNodeMap:m=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:p,trustedTypes:f}=t,h=s.prototype,g=de(h,"cloneNode"),y=de(h,"remove"),T=de(h,"nextSibling"),S=de(h,"childNodes"),A=de(h,"parentNode");if("function"==typeof l){const e=r.createElement("template");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let b,E="";const{implementation:w,createNodeIterator:N,createDocumentFragment:v,getElementsByTagName:C}=r,{importNode:x}=o;let _={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof U&&"function"==typeof A&&w&&void 0!==w.createHTMLDocument;const{MUSTACHE_EXPR:D,ERB_EXPR:R,TMPLIT_EXPR:O,DATA_ATTR:k,ARIA_ATTR:L,IS_SCRIPT_OR_DATA:I,ATTR_WHITESPACE:M,CUSTOM_ELEMENT:P}=Ie;let{IS_ALLOWED_URI:H}=Ie,F=null;const B=se({},[...pe,...fe,...he,...ye,...Se]);let z=null;const q=se({},[...Ae,...be,...Ee,...we]);let W=Object.seal(G(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Y=null,le=null;const ce=Object.seal(G(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ue=!0,Ne=!0,ve=!1,Ce=!0,xe=!1,_e=!0,Re=!1,Oe=!1,Le=!1,Pe=!1,Ue=!1,He=!1,Fe=!0,Be=!1,ze=!0,$e=!1,qe={},Ge=null;const We=se({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ye=null;const je=se({},["audio","video","img","source","image","track"]);let Ve=null;const Xe=se({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ke="http://www.w3.org/1998/Math/MathML",Ze="http://www.w3.org/2000/svg",Qe="http://www.w3.org/1999/xhtml";let Je=Qe,et=!1,tt=null;const nt=se({},[Ke,Ze,Qe],J);let rt=se({},["mi","mo","mn","ms","mtext"]),ot=se({},["annotation-xml"]);const it=se({},["title","style","font","a","script"]);let at=null;const lt=["application/xhtml+xml","text/html"];let ct=null,st=null;const ut=r.createElement("form"),mt=function(e){return e instanceof RegExp||e instanceof Function},dt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!st||st!==e){if(e&&"object"==typeof e||(e={}),e=me(e),at=-1===lt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ct="application/xhtml+xml"===at?J:Q,F=oe(e,"ALLOWED_TAGS")?se({},e.ALLOWED_TAGS,ct):B,z=oe(e,"ALLOWED_ATTR")?se({},e.ALLOWED_ATTR,ct):q,tt=oe(e,"ALLOWED_NAMESPACES")?se({},e.ALLOWED_NAMESPACES,J):nt,Ve=oe(e,"ADD_URI_SAFE_ATTR")?se(me(Xe),e.ADD_URI_SAFE_ATTR,ct):Xe,Ye=oe(e,"ADD_DATA_URI_TAGS")?se(me(je),e.ADD_DATA_URI_TAGS,ct):je,Ge=oe(e,"FORBID_CONTENTS")?se({},e.FORBID_CONTENTS,ct):We,Y=oe(e,"FORBID_TAGS")?se({},e.FORBID_TAGS,ct):me({}),le=oe(e,"FORBID_ATTR")?se({},e.FORBID_ATTR,ct):me({}),qe=!!oe(e,"USE_PROFILES")&&e.USE_PROFILES,ue=!1!==e.ALLOW_ARIA_ATTR,Ne=!1!==e.ALLOW_DATA_ATTR,ve=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Ce=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,xe=e.SAFE_FOR_TEMPLATES||!1,_e=!1!==e.SAFE_FOR_XML,Re=e.WHOLE_DOCUMENT||!1,Pe=e.RETURN_DOM||!1,Ue=e.RETURN_DOM_FRAGMENT||!1,He=e.RETURN_TRUSTED_TYPE||!1,Le=e.FORCE_BODY||!1,Fe=!1!==e.SANITIZE_DOM,Be=e.SANITIZE_NAMED_PROPS||!1,ze=!1!==e.KEEP_CONTENT,$e=e.IN_PLACE||!1,H=e.ALLOWED_URI_REGEXP||De,Je=e.NAMESPACE||Qe,rt=e.MATHML_TEXT_INTEGRATION_POINTS||rt,ot=e.HTML_INTEGRATION_POINTS||ot,W=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&mt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&mt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(W.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),xe&&(Ne=!1),Ue&&(Pe=!0),qe&&(F=se({},Se),z=[],!0===qe.html&&(se(F,pe),se(z,Ae)),!0===qe.svg&&(se(F,fe),se(z,be),se(z,we)),!0===qe.svgFilters&&(se(F,he),se(z,be),se(z,we)),!0===qe.mathMl&&(se(F,ye),se(z,Ee),se(z,we))),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?ce.tagCheck=e.ADD_TAGS:(F===B&&(F=me(F)),se(F,e.ADD_TAGS,ct))),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?ce.attributeCheck=e.ADD_ATTR:(z===q&&(z=me(z)),se(z,e.ADD_ATTR,ct))),e.ADD_URI_SAFE_ATTR&&se(Ve,e.ADD_URI_SAFE_ATTR,ct),e.FORBID_CONTENTS&&(Ge===We&&(Ge=me(Ge)),se(Ge,e.FORBID_CONTENTS,ct)),e.ADD_FORBID_CONTENTS&&(Ge===We&&(Ge=me(Ge)),se(Ge,e.ADD_FORBID_CONTENTS,ct)),ze&&(F["#text"]=!0),Re&&se(F,["html","head","body"]),F.table&&(se(F,["tbody"]),delete Y.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw ae('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw ae('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');b=e.TRUSTED_TYPES_POLICY,E=b.createHTML("")}else void 0===b&&(b=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const o="dompurify"+(n?"#"+n:"");try{return e.createPolicy(o,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+o+" could not be created."),null}}(f,i)),null!==b&&"string"==typeof E&&(E=b.createHTML(""));$&&$(e),st=e}},pt=se({},[...fe,...he,...ge]),ft=se({},[...ye,...Te]),ht=function(e){K(n.removed,{element:e});try{A(e).removeChild(e)}catch(t){y(e)}},gt=function(e,t){try{K(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){K(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(Pe||Ue)try{ht(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},yt=function(e){let t=null,n=null;if(Le)e="<remove></remove>"+e;else{const t=ee(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===at&&Je===Qe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=b?b.createHTML(e):e;if(Je===Qe)try{t=(new p).parseFromString(o,at)}catch(e){}if(!t||!t.documentElement){t=w.createDocument(Je,"template",null);try{t.documentElement.innerHTML=et?E:o}catch(e){}}const i=t.body||t.documentElement;return e&&n&&i.insertBefore(r.createTextNode(n),i.childNodes[0]||null),Je===Qe?C.call(t,Re?"html":"body")[0]:Re?t.documentElement:i},Tt=function(e){return N.call(e.ownerDocument||e,e,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},St=function(e){return e instanceof d&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof m)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},At=function(e){return"function"==typeof c&&e instanceof c};function bt(e,t,r){j(e,e=>{e.call(n,t,r,st)})}const Et=function(e){let t=null;if(bt(_.beforeSanitizeElements,e,null),St(e))return ht(e),!0;const r=ct(e.nodeName);if(bt(_.uponSanitizeElement,e,{tagName:r,allowedTags:F}),_e&&e.hasChildNodes()&&!At(e.firstElementChild)&&ie(/<[/\w!]/g,e.innerHTML)&&ie(/<[/\w!]/g,e.textContent))return ht(e),!0;if(7===e.nodeType)return ht(e),!0;if(_e&&8===e.nodeType&&ie(/<[/\w]/g,e.data))return ht(e),!0;if(!(ce.tagCheck instanceof Function&&ce.tagCheck(r))&&(!F[r]||Y[r])){if(!Y[r]&&Nt(r)){if(W.tagNameCheck instanceof RegExp&&ie(W.tagNameCheck,r))return!1;if(W.tagNameCheck instanceof Function&&W.tagNameCheck(r))return!1}if(ze&&!Ge[r]){const t=A(e)||e.parentNode,n=S(e)||e.childNodes;if(n&&t)for(let r=n.length-1;r>=0;--r){const o=g(n[r],!0);o.__removalCount=(e.__removalCount||0)+1,t.insertBefore(o,T(e))}}return ht(e),!0}return e instanceof s&&!function(e){let t=A(e);t&&t.tagName||(t={namespaceURI:Je,tagName:"template"});const n=Q(e.tagName),r=Q(t.tagName);return!!tt[e.namespaceURI]&&(e.namespaceURI===Ze?t.namespaceURI===Qe?"svg"===n:t.namespaceURI===Ke?"svg"===n&&("annotation-xml"===r||rt[r]):Boolean(pt[n]):e.namespaceURI===Ke?t.namespaceURI===Qe?"math"===n:t.namespaceURI===Ze?"math"===n&&ot[r]:Boolean(ft[n]):e.namespaceURI===Qe?!(t.namespaceURI===Ze&&!ot[r])&&!(t.namespaceURI===Ke&&!rt[r])&&!ft[n]&&(it[n]||!pt[n]):!("application/xhtml+xml"!==at||!tt[e.namespaceURI]))}(e)?(ht(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!ie(/<\/no(script|embed|frames)/i,e.innerHTML)?(xe&&3===e.nodeType&&(t=e.textContent,j([D,R,O],e=>{t=te(t,e," ")}),e.textContent!==t&&(K(n.removed,{element:e.cloneNode()}),e.textContent=t)),bt(_.afterSanitizeElements,e,null),!1):(ht(e),!0)},wt=function(e,t,n){if(Fe&&("id"===t||"name"===t)&&(n in r||n in ut))return!1;if(Ne&&!le[t]&&ie(k,t));else if(ue&&ie(L,t));else if(ce.attributeCheck instanceof Function&&ce.attributeCheck(t,e));else if(!z[t]||le[t]){if(!(Nt(e)&&(W.tagNameCheck instanceof RegExp&&ie(W.tagNameCheck,e)||W.tagNameCheck instanceof Function&&W.tagNameCheck(e))&&(W.attributeNameCheck instanceof RegExp&&ie(W.attributeNameCheck,t)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(t,e))||"is"===t&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&ie(W.tagNameCheck,n)||W.tagNameCheck instanceof Function&&W.tagNameCheck(n))))return!1}else if(Ve[t]);else if(ie(H,te(n,M,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==ne(n,"data:")||!Ye[e])if(ve&&!ie(I,te(n,M,"")));else if(n)return!1;return!0},Nt=function(e){return"annotation-xml"!==e&&ee(e,P)},vt=function(e){bt(_.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||St(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:z,forceKeepAttr:void 0};let o=t.length;for(;o--;){const i=t[o],{name:a,namespaceURI:l,value:c}=i,s=ct(a),u=c;let m="value"===a?u:re(u);if(r.attrName=s,r.attrValue=m,r.keepAttr=!0,r.forceKeepAttr=void 0,bt(_.uponSanitizeAttribute,e,r),m=r.attrValue,!Be||"id"!==s&&"name"!==s||(gt(a,e),m="user-content-"+m),_e&&ie(/((--!?|])>)|<\/(style|title|textarea)/i,m)){gt(a,e);continue}if("attributename"===s&&ee(m,"href")){gt(a,e);continue}if(r.forceKeepAttr)continue;if(!r.keepAttr){gt(a,e);continue}if(!Ce&&ie(/\/>/i,m)){gt(a,e);continue}xe&&j([D,R,O],e=>{m=te(m,e," ")});const d=ct(e.nodeName);if(wt(d,s,m)){if(b&&"object"==typeof f&&"function"==typeof f.getAttributeType)if(l);else switch(f.getAttributeType(d,s)){case"TrustedHTML":m=b.createHTML(m);break;case"TrustedScriptURL":m=b.createScriptURL(m)}if(m!==u)try{l?e.setAttributeNS(l,a,m):e.setAttribute(a,m),St(e)?ht(e):X(n.removed)}catch(t){gt(a,e)}}else gt(a,e)}bt(_.afterSanitizeAttributes,e,null)},Ct=function e(t){let n=null;const r=Tt(t);for(bt(_.beforeSanitizeShadowDOM,t,null);n=r.nextNode();)bt(_.uponSanitizeShadowNode,n,null),Et(n),vt(n),n.content instanceof a&&e(n.content);bt(_.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null,i=null,l=null,s=null;if(et=!e,et&&(e="\x3c!--\x3e"),"string"!=typeof e&&!At(e)){if("function"!=typeof e.toString)throw ae("toString is not a function");if("string"!=typeof(e=e.toString()))throw ae("dirty is not a string, aborting")}if(!n.isSupported)return e;if(Oe||dt(t),n.removed=[],"string"==typeof e&&($e=!1),$e){if(e.nodeName){const t=ct(e.nodeName);if(!F[t]||Y[t])throw ae("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof c)r=yt("\x3c!----\x3e"),i=r.ownerDocument.importNode(e,!0),1===i.nodeType&&"BODY"===i.nodeName||"HTML"===i.nodeName?r=i:r.appendChild(i);else{if(!Pe&&!xe&&!Re&&-1===e.indexOf("<"))return b&&He?b.createHTML(e):e;if(r=yt(e),!r)return Pe?null:He?E:""}r&&Le&&ht(r.firstChild);const u=Tt($e?e:r);for(;l=u.nextNode();)Et(l),vt(l),l.content instanceof a&&Ct(l.content);if($e)return e;if(Pe){if(Ue)for(s=v.call(r.ownerDocument);r.firstChild;)s.appendChild(r.firstChild);else s=r;return(z.shadowroot||z.shadowrootmode)&&(s=x.call(o,s,!0)),s}let m=Re?r.outerHTML:r.innerHTML;return Re&&F["!doctype"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&ie(ke,r.ownerDocument.doctype.name)&&(m="<!DOCTYPE "+r.ownerDocument.doctype.name+">\n"+m),xe&&j([D,R,O],e=>{m=te(m,e," ")}),b&&He?b.createHTML(m):m},n.setConfig=function(){dt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Oe=!0},n.clearConfig=function(){st=null,Oe=!1},n.isValidAttribute=function(e,t,n){st||dt({});const r=ct(e),o=ct(t);return wt(r,o,n)},n.addHook=function(e,t){"function"==typeof t&&K(_[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=V(_[e],t);return-1===n?void 0:Z(_[e],n,1)[0]}return X(_[e])},n.removeHooks=function(e){_[e]=[]},n.removeAllHooks=function(){_={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();class Ue{constructor(){this.name="YouTube DOM Extraction",this.priority=1}canHandle(e){return e.includes("youtube.com/watch")||e.includes("youtu.be/")}async extract(t=1e4){const n=await async function(){const t=document.querySelector("h1.title yt-formatted-string")?.textContent?.trim()||document.querySelector('meta[property="og:title"]')?.getAttribute("content")||document.title.replace(" - YouTube","").trim(),n=document.querySelector("#channel-name")?.textContent?.trim()||"",r=document.querySelector("#subscriber-count")?.textContent?.trim()||"",o=document.querySelector("#info-strings yt-formatted-string")?.textContent?.trim()||"";return{title:t,channel:n,subscribers:r,views:document.querySelector("#info #count .view-count")?.textContent?.trim()||"",dateTime:o,chapters:await async function(){await e(2e3);const t=document.querySelector('ytd-engagement-panel-section-list-renderer[target-id="engagement-panel-structured-description"]');if(t){const e=t.querySelectorAll("yt-formatted-string.ytd-macro-markers-list-item-renderer");if(e.length>0)return Array.from(e).map(e=>e.textContent?.trim()).filter(Boolean).join("\n")}const n=[...(document.querySelector("#description-inline-expander")?.textContent||"").matchAll(/(\d{1,2}:\d{2})\s+(.+)/g)];return n.length>0?n.map(e=>`${e[1]} ${e[2]}`).join("\n"):"No chapters available"}(),description:await async function(){await e(2e3);const t=document.querySelector("#description #expand");t&&(t.click(),await e(1e3));const n=document.querySelector("#description-inline-expander");if(n){const e=n.cloneNode(!0);e.querySelectorAll("a, #description-inline-expander-link").forEach(e=>e.remove());let t=e.textContent?.trim()||"";const r=t.indexOf("‚Ä¶...more");return-1!==r&&(t=t.substring(0,r).trim()),t||"No description available"}return"No description available"}(),transcript:await async function(){return new Promise(e=>{const t=document.querySelector('button[aria-label="Show transcript"]');t?(t.click(),setTimeout(()=>{const t=document.querySelectorAll("yt-formatted-string.ytd-transcript-segment-renderer");if(0===t.length)return void e("Transcript not available");const n=Array.from(t).filter((e,t)=>t%2!=0).map(e=>e.textContent?.trim()).filter(Boolean).join(" ");e(n||"Transcript not available")},2e3)):e("Transcript not available")})}()}}(),r=n.dateTime?this.parseYouTubeDate(n.dateTime):void 0;return{title:n.title,url:window.location.href,content:this.formatContent(n),timestamp:(new Date).toISOString(),author:n.channel?[n.channel]:void 0,published:r,description:"No description available"!==n.description?n.description:void 0}}formatContent(e){const t=[];return e.channel&&t.push(`**Channel:** ${e.channel}`),e.subscribers&&t.push(`**Subscribers:** ${e.subscribers}`),e.views&&t.push(`**Views:** ${e.views}`),e.dateTime&&t.push(`**Published:** ${e.dateTime}`),t.push("","---",""),e.chapters&&"No chapters available"!==e.chapters&&t.push("## Chapters","",e.chapters,"","---",""),e.description&&"No description available"!==e.description&&t.push("## Description","",e.description,"","---",""),e.transcript&&"Transcript not available"!==e.transcript?t.push("## Transcript","",e.transcript,"","---",""):t.push("## Transcript","","> ‚ö†Ô∏è **Transcript not available**","> ","> This video may not have captions enabled, or transcript extraction failed.","","---",""),t.push("## Notes","","\x3c!-- Add your notes here --\x3e"),t.join("\n")}parseYouTubeDate(e){try{const t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}catch(e){}}}class He{constructor(){this.name="YouTube Data API",this.priority=2}canHandle(e){return e.includes("youtube.com/watch")||e.includes("youtu.be/")}async extract(e=1e4){if(!this.extractVideoId(window.location.href))throw new Error("Could not extract video ID");throw new Error("YouTube API not configured")}extractVideoId(e){const t=e.match(/[?&]v=([^&]+)/);return t?t[1]:null}}class Fe{constructor(){this.name="Twitter DOM Extraction",this.priority=1}canHandle(e){return e.includes("twitter.com")||e.includes("x.com")}async extract(e=1e4){const r=function(){try{const e=document.querySelector('article[data-testid="tweet"]');if(!e)return null;const n=t(e);if(!n)return null;const r=document.querySelectorAll('article[data-testid="tweet"]'),o=[];for(let e=1;e<Math.min(r.length,12);e++){const n=t(r[e]);n&&o.push(n)}return{mainTweet:n,replies:o}}catch(e){return console.error("Failed to extract tweet:",e),null}}();if(!r)throw new Error("Could not extract tweet");return{title:`Tweet by ${r.mainTweet.author}`,url:window.location.href,content:n(r),timestamp:(new Date).toISOString()}}}class Be{constructor(){this.name="General Web Extraction",this.priority=10,this.turndown=new P({headingStyle:"atx",codeBlockStyle:"fenced",bulletListMarker:"-",emDelimiter:"*"})}canHandle(e){return!0}async extract(e=1e4){const t=this.extractMetadata();return{title:document.title,url:window.location.href,content:this.extractMainContent(),timestamp:(new Date).toISOString(),...t}}extractMetadata(){const e={},t=document.querySelector('meta[property="og:description"]')?.getAttribute("content")||document.querySelector('meta[name="description"]')?.getAttribute("content")||document.querySelector('meta[name="twitter:description"]')?.getAttribute("content");t&&(e.description=t);const n=document.querySelector('meta[property="article:author"]')?.getAttribute("content")||document.querySelector('meta[name="author"]')?.getAttribute("content")||document.querySelector('meta[property="og:author"]')?.getAttribute("content");n&&(e.author=n.split(/[,;&]/).map(e=>e.trim()).filter(e=>e.length>0));const r=document.querySelector('meta[property="article:published_time"]')?.getAttribute("content")||document.querySelector('meta[name="publication_date"]')?.getAttribute("content")||document.querySelector('meta[property="og:published_time"]')?.getAttribute("content")||document.querySelector("time[datetime]")?.getAttribute("datetime");if(r)try{const t=new Date(r);isNaN(t.getTime())||(e.published=t.toISOString().split("T")[0])}catch(t){e.published=r}const o=document.querySelector('meta[property="og:site_name"]')?.getAttribute("content")||document.querySelector('meta[name="application-name"]')?.getAttribute("content");return o&&(e.siteName=o),e}extractMainContent(){const e=document.querySelector("main")||document.querySelector("article")||document.querySelector('[role="main"]')||document.body;if(!e)return"";const t=e.cloneNode(!0);["script","style","nav","header","footer","svg","text",".advertisement",".ad",".social-share",".comments",'[role="navigation"]','[role="complementary"]'].forEach(e=>{t.querySelectorAll(e).forEach(e=>e.remove())});const n=t.innerHTML;let r="";try{r=Pe.sanitize(n,{ALLOWED_TAGS:["p","br","strong","em","u","h1","h2","h3","h4","h5","h6","ul","ol","li","a","blockquote","code","pre","img","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","src","alt","title"]})}catch(e){console.warn("DOMPurify failed, falling back to text content:",e);return t.textContent?.trim()||""}return this.turndown.turndown(r)}}class ze{constructor(){this.strategies=[new Ue,new He,new Fe,new Be]}async extract(e,t=1e4){const n=this.strategies.filter(t=>t.canHandle(e)).sort((e,t)=>e.priority-t.priority);let r=null;for(const e of n)try{console.log(`Trying extraction strategy: ${e.name}`);const n=await this.withTimeout(e.extract(t),t);if(this.isValidResult(n))return console.log(`‚úì Success with strategy: ${e.name}`),n}catch(t){console.warn(`‚úó Strategy ${e.name} failed:`,t),r=t instanceof Error?t:new Error(String(t));continue}throw new Error(`All extraction strategies failed. Last error: ${r?.message}`)}async withTimeout(e,t){return Promise.race([e,new Promise((e,n)=>setTimeout(()=>n(new Error("Extraction timeout")),t))])}isValidResult(e){return!!(e.title&&e.url&&e.content)}addStrategy(e){this.strategies.push(e),this.strategies.sort((e,t)=>e.priority-t.priority)}}!async function(){const e=window.location.href,t=new ze;try{let n=await t.extract(e,3e4);const r=window.getSelection(),o=r&&r.toString().trim()?r.toString():void 0;o&&!n.selectedText&&(n.selectedText=o),console.log("üì§ Sending CONTENT_EXTRACTED message to background..."),chrome.runtime.sendMessage({type:"CONTENT_EXTRACTED",data:n},e=>{chrome.runtime.lastError?console.error("‚ùå Error sending message:",chrome.runtime.lastError):console.log("‚úÖ Message sent successfully, response:",e)}),console.log("‚úÖ Content extracted and sent to background script")}catch(e){console.error("All extraction strategies failed:",e);const t=function(){const e=document.title||"Untitled",t=window.location.href,n=window.getSelection(),r=n&&n.toString().trim()?n.toString():void 0,o=document.querySelector("main")||document.querySelector("article")||document.querySelector('[role="main"]')||document.body;return{title:e,url:t,content:(o?.textContent?.trim()||"No content extracted").substring(0,5e4),selectedText:r,timestamp:(new Date).toISOString()}}();chrome.runtime.sendMessage({type:"CONTENT_EXTRACTED",data:t})}}()})();